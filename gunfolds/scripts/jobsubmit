#!/bin/bash
#SBATCH -N 1
#SBATCH -n 1
#SBATCH -c 1  # Placeholder value, will be updated
#SBATCH --mem=150g
#SBATCH -p qTRDGPU
#SBATCH -t 7600
#SBATCH -J data
#SBATCH -e ./err/error%A-%a.err
#SBATCH -o ./out/out%A-%a.out
#SBATCH -A psy53c17
#SBATCH --mail-type=ALL
#SBATCH --mail-user=mabavisani@gsu.edu
#SBATCH --oversubscribe

sleep 1s

# Parameters
total_jobs=180
b=$(( ($SLURM_ARRAY_TASK_ID - 1) % 60 + 1 ))
u=$(( (($SLURM_ARRAY_TASK_ID - 1) / 60) + 1 ))

p=15
o=mRASL

# Update job name with parameters
job_name="d_${o}_${b}_${u}"
scontrol update jobid=$SLURM_JOB_ID name=$job_name

# Update the number of CPUs allocated
scontrol update jobid=$SLURM_JOB_ID NumCPUs=$p

# Set OMP_NUM_THREADS to the value of $p
export OMP_NUM_THREADS=$p

export MODULEPATH=/apps/Compilers/modules-3.2.10/Debug-Build/Modules/3.2.10/modulefiles/
echo $HOSTNAME >&2

source /home/users/mabavisani/anaconda3/bin/activate
conda activate gt_density

# Run the Python script
python VAR_ringmore_V_ruben.py -b=$b -p=$p -u=$u -o=$o
